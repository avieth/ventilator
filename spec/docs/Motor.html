<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Motor</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ventilator-spec-0.1.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Motor</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Definitions related to the motor, its hardware driver, and rotary encoder.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:steps_per_rotation">steps_per_rotation</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a></li><li class="src short"><a href="#v:pulses_per_rotation">pulses_per_rotation</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a></li><li class="src short"><a href="#v:md_encoder_position">md_encoder_position</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:PulseData">PulseData</a> = Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a></li><li class="src short"><a href="#v:pulse_data_from_velocity_dps">pulse_data_from_velocity_dps</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; <a href="Motor.html#t:PulseData" title="Motor">PulseData</a></li><li class="src short"><a href="#v:limit_motor_velocity">limit_motor_velocity</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:steps_per_rotation" class="def">steps_per_rotation</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> <a href="#v:steps_per_rotation" class="selflink">#</a></p><div class="doc"><p>How many steps per revolution. This will be known and static for the
 device, so is not really a configuration variable.</p><p>Found that 3200 does not work; the motor can't be made to move even at 90
 degrees per second with this configuration. 1600 is fine though.</p></div></div><div class="top"><p class="src"><a id="v:pulses_per_rotation" class="def">pulses_per_rotation</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word32" title="Data.Word">Word32</a> <a href="#v:pulses_per_rotation" class="selflink">#</a></p><div class="doc"><p>How many encoder pulses per revolution.</p></div></div><div class="top"><p class="src"><a id="v:md_encoder_position" class="def">md_encoder_position</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> <a href="#v:md_encoder_position" class="selflink">#</a></p><div class="doc"><p>How many millidegrees between two encoder positions, with a sign
 according to the relative magnitudes (positive if the first is greater
 than the second).</p><p>TODO don't use millidegrees or radians, use instead subdivisions of Pi.
 The encoder divides 2Pi into 2048 equal arc lengths. If the encoder
 position is n greater than the low encoder position, then we have moved
 nPi/2048 radians. Ideally our trig computations can work in terms of
 Pi/2048 rather than degrees or radians.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:PulseData" class="def">PulseData</a> = Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> <a href="#t:PulseData" class="selflink">#</a></p><div class="doc"><p>Microseconds per pulse, where the sign gives direction. 0 means no
 movement.</p></div></div><div class="top"><p class="src"><a id="v:pulse_data_from_velocity_dps" class="def">pulse_data_from_velocity_dps</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; <a href="Motor.html#t:PulseData" title="Motor">PulseData</a> <a href="#v:pulse_data_from_velocity_dps" class="selflink">#</a></p><div class="doc"><p>Given a desired degrees-per-second velocity, compute the microseconds
 per pulse and direction (its sign).</p><p>Microseconds per pulse is 0 if the speed is 0.</p><p>Uses the high and low switches to clamp the rate so that it does not
 move backwards when the low switch is on, for instance.</p><p>Enforces limits on speed according to the encoder, so that the piston
 assembly will not slam the endpoints and risk damage.
 Since the low and high switches set the encoder offsets, this also enforces
 0 speed at the endpoints.</p></div></div><div class="top"><p class="src"><a id="v:limit_motor_velocity" class="def">limit_motor_velocity</a> :: Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> -&gt; Stream <a href="file:///nix/store/0wffxskjn0q9i1jdasgvs4p0pg4krja1-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> <a href="#v:limit_motor_velocity" class="selflink">#</a></p><div class="doc"><p>If the machine is calibrated for the motor (high and low switches used
 to set encoder offsets high and low), then this function may be used to
 give a limit on the velocity, so as to ensure the motor does not slam the
 piston against the endpoints.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>