<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ventilator</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ventilator-spec-0.1.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ventilator</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This is a <a href="https://copilot-language.github.io/">copilot</a> program designed
to control a mechanical ventilatilation system.</p><p>The program works with data streams (type `Stream Int32` for instance),
some of which are &quot;extern&quot; (set by a C program), and it defines &quot;triggers&quot;,
which correspond to C functions which will be called whenever a given
condition (a `Stream Bool`) is true, and passed a set of values (sampled
from the specified <code>Stream</code>s).</p><p>A program specification is a set of triggers, their condition signals, and
the arguments which they receive. This can be simulated in Haskell by giving
mock values for the &quot;extern&quot; signals. It can also be compiled to C with C
extern declarations for all &quot;extern&quot; signals as well as all declared
triggers.</p><p>The specification for this program is called <code><a href="Ventilator.html#v:spec" title="Ventilator">spec</a></code>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:pulsedata">pulsedata</a> :: <a href="Motor.html#t:PulseData" title="Motor">PulseData</a></li><li class="src short"><a href="#v:motor_velocity">motor_velocity</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a></li><li class="src short"><a href="#v:calibration_phase">calibration_phase</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:calibration_phase_change">calibration_phase_change</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:calibration_phase_next">calibration_phase_next</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a></li><li class="src short"><a href="#v:alarm">alarm</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:safe_to_move">safe_to_move</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li class="src short"><a href="#v:spec">spec</a> :: Spec</li><li class="src short"><a href="#v:gen_c">gen_c</a> :: <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:pulsedata" class="def">pulsedata</a> :: <a href="Motor.html#t:PulseData" title="Motor">PulseData</a> <a href="#v:pulsedata" class="selflink">#</a></p><div class="doc"><p>Motor pulse data: converts the degrees-per-second velocity into the
 time between pulses, using hard-coded properties of the particular motor
 and driver.</p></div></div><div class="top"><p class="src"><a id="v:motor_velocity" class="def">motor_velocity</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Int.html#t:Int32" title="Data.Int">Int32</a> <a href="#v:motor_velocity" class="selflink">#</a></p><div class="doc"><p>Calculate the desired motor velocity at an instant (degrees-per-second).</p><p>This is the essence of the ventilator program.</p></div></div><div class="top"><p class="src"><a id="v:calibration_phase" class="def">calibration_phase</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="#v:calibration_phase" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:calibration_phase_change" class="def">calibration_phase_change</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:calibration_phase_change" class="selflink">#</a></p><div class="doc"><p>Is true whenever the current calibration phase differs from the
 previous one. Used to trigger function. Useful for debugging, to check
 the encoder value.</p></div></div><div class="top"><p class="src"><a id="v:calibration_phase_next" class="def">calibration_phase_next</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Word.html#t:Word8" title="Data.Word">Word8</a> <a href="#v:calibration_phase_next" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:alarm" class="def">alarm</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:alarm" class="selflink">#</a></p><div class="doc"><p>Give True whenever human intervention is required.</p><p>As seen in <code><a href="Ventilator.html#v:spec" title="Ventilator">spec</a></code>, this signal controls when the C function raise_alarm will
 be called. That function would probably sound a buzzer and flash some
 lights.</p><p>TODO the alarm should give a code to indicate which signals are inconsistent,
 so that the UI signal can use it.
 Also should probably distinguish between critical alarms which imply motor
 shutdown, and warnings which do not.</p><p>TODO an alarm in case the high sensor is true but desired volume or
 pressure was not reached.</p></div></div><div class="top"><p class="src"><a id="v:safe_to_move" class="def">safe_to_move</a> :: Stream <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:safe_to_move" class="selflink">#</a></p><div class="doc"><p>The motor will not move unless this is true.</p><p>For now it's false whenever there is an alarm.
 Will need something better moving forward.</p><p>TODO FIXME is it better to have the kill switch mean bring the piston back
 to 0 and stay there until the operator intervenes? Would probably not be
 good to kill the motor with a high volume and pressure in the system.</p></div></div><div class="top"><p class="src"><a id="v:spec" class="def">spec</a> :: Spec <a href="#v:spec" class="selflink">#</a></p><div class="doc"><p>The spec for the ventilator program.</p></div></div><div class="top"><p class="src"><a id="v:gen_c" class="def">gen_c</a> :: <a href="file:///nix/store/b6m1rb4mym4j85kmsrqbp0r4lmva3iyv-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:gen_c" class="selflink">#</a></p><div class="doc"><p>Write out the spec to C in <code>ventilator.h</code> and <code>ventilator.c</code></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>